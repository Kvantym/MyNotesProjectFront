<div class="board-container" *ngIf="board">
  <div class="board-header">
    <h2>{{ board.name }}</h2>
    <button class="btn add-list" (click)="addList()">+ Add list</button>
  </div>

  <div class="lists-wrapper">
    <div class="list-card" *ngFor="let list of lists">
      <div class="list-header">
        <!-- Назва списку обрізається до 25 символів, повна назва в title -->
        <h3 [title]="list.name">{{ list.name | slice:0:25 }}{{ list.name.length > 25 ? '...' : '' }}</h3>

        <div class="list-actions">

          <button class="btn icon add-card" (click)="addCard(list.id)" title="Add cart">

  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
    <path d="M8 1a.5.5 0 0 1 .5.5V7.5H14a.5.5 0 0 1 0 1H8.5V14a.5.5 0 0 1-1 0V8.5H2a.5.5 0 0 1 0-1h5.5V1.5A.5.5 0 0 1 8 1z"/>
  </svg>
</button>
    <button class="btn more-btn"
            (click)="openShowListCarForm(list.id); $event.stopPropagation()"
            title="Show list information">
      ⋮
    </button>
        </div>
      </div>



    <div class="cards-wrapper">
  <div class="card-item" *ngFor="let card of list.carts">

    <div class="card-info" [title]="card.name">
      <strong>{{ card.name | slice:0:25 }}{{ card.name.length > 25 ? '...' : '' }}</strong>
      <p>{{ card.description | slice:0:50 }}{{ card.description.length > 50 ? '...' : '' }}</p>
    </div>

    <!-- Кнопка "три крапки" -->
    <button class="btn more-btn"
            (click)="openShowCarForm(card.id); $event.stopPropagation()"
            title="Show cart information">
      ⋮
    </button>

    <!-- Форма переміщення картки -->
    <div class="move-cart-container" *ngIf="lists && lists.length">
      <label for="moveCartSelect">Move cart to list:</label>
      <select id="moveCartSelect"
              [(ngModel)]="card.selectedCartListId"
              (change)="moveCartToCartList(card.selectedCartListId, card.id)">
        <option
          *ngFor="let listOption of lists"
          [value]="listOption.id"
          [disabled]="listOption.id === list.id">
          {{ listOption.name | slice:0:25 }}{{ listOption.name.length > 25 ? '...' : '' }}
        </option>
      </select>
    </div>

  </div>
</div>

    </div>
  </div>
</div>

<div *ngIf="!board" class="loading">
  <p>Load board...</p>
</div>

<!-- Модалки -->
<!-- Update CartList -->
<app-cartList-updateCartList
  *ngIf="showUpdateCartListForm"
  [cartList]="selectedCartList"
  (closeModal)="cancelEditCart()"
  (cartUpdated)="loadLists()"
  (closeModal)="loadLists()"> <!-- 🔥 оновлення списків -->
</app-cartList-updateCartList>

<!-- Update Cart -->
<div class="modal-overlay" *ngIf="isUpdateCartModalOpen" (click)="closeUpdateCartModal()"></div>
<app-cart-updateCart
  *ngIf="isUpdateCartModalOpen"
  [cart]="selectedCart"
  (closeModal)="closeUpdateCartModal()"
  (cartUpdated)="loadLists()"> <!-- 🔥 оновлення карток -->
</app-cart-updateCart>

<!-- Create CartList -->
<div *ngIf="isCreateCartListOpen" class="modal-overlay">
  <app-cartList-createCartList
    [boardId]="boardId"
    (closeModal)="closeCreateCartListModal()"
    (cartListCreated)="loadLists()"
    (closeModal)="loadLists()">
  </app-cartList-createCartList>
</div>

<!-- Create Cart -->
<div *ngIf="isCreateCartOpen" class="modal-overlay">
  <app-createCart-createCart
    [cartListId]="cartListId"
    (closeModal)="closeCreateCartModal()"
    (cartCreated)="loadLists()"> <!-- 🔥 оновлення після створення -->
  </app-createCart-createCart>
</div>
<div *ngIf="showCartModalOpen" class="modal-overlay" (click)="closeShowCartModal()">
  <app-cart-showCart
    [cartId]="showCartId"
    (closeModal)="closeShowCartModal()"
    (click)="$event.stopPropagation()"
    (cartUpdated)="loadLists()"
    (closeModal)="loadLists()">
  </app-cart-showCart>
</div>
<div *ngIf="showCartListModalOpen" class="modal-overlay" (click)="closeShowListCartModal()">
  <app-cartList-showcartlist
        [cartListId]="showCartListId"
    (closeModal)="closeShowListCartModal()"
    (click)="$event.stopPropagation()"
    (cartListUpdated)="loadLists()"
    (closeModal)="loadLists()">
  </app-cartList-showcartlist>
</div>


